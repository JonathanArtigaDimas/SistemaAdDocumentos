<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Sistema de Administraci√≥n de Archivos</title>
    <link rel="stylesheet" href="index.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
  </head>

  <body>
    <!-- Men√∫ de usuario -->
    <div class="user-menu">
        <div class="user-button" onclick="toggleUserMenu()">
            <div class="user-avatar" id="userAvatar">U</div>
            <span id="userName">Usuario</span>
        </div>
        <div class="user-dropdown" id="userDropdown">
            <div class="user-dropdown-item" onclick="showProfileModal()">
                Editar Perfil
            </div>
            <div class="user-dropdown-item" onclick="showUserSwitchModal()">
                Cambiar Usuario
            </div>
            <div class="user-dropdown-item" id="adminMenuItem" style="display: none" onclick="showAdminModal()">
                Administrar Usuarios
            </div>
            <div class="user-dropdown-item" onclick="logout()">
                Cerrar Sesi√≥n
            </div>
        </div>
    </div>

    <!-- Modal de inicio de sesi√≥n -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <h3>Iniciar Sesi√≥n</h3>
            <div class="form-group">
                <label>Usuario:</label>
                <input type="text" id="loginUsername" class="form-control" required>
            </div>
            <div class="form-group">
                <label>Contrase√±a:</label>
                <input type="password" id="loginPassword" class="form-control" required>
            </div>
            <button onclick="login()" class="btn btn-primary">Iniciar Sesi√≥n</button>
            <button onclick="showRegisterModal()" class="btn">Registrarse</button>
        </div>
    </div>

    <!-- Modal de registro -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <h3>Registrarse</h3>
            <div class="form-group">
                <label>Usuario:</label>
                <input type="text" id="registerUsername" class="form-control" required>
            </div>
            <div class="form-group">
                <label>Contrase√±a:</label>
                <input type="password" id="registerPassword" class="form-control" required>
            </div>
            <div class="form-group">
                <label>Nombre completo:</label>
                <input type="text" id="registerFullName" class="form-control" required>
            </div>
            <button onclick="register()" class="btn btn-primary">Registrarse</button>
            <button onclick="closeModal()" class="btn">Cancelar</button>
        </div>
    </div>

    <!-- Modal de perfil -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <h3>Editar Perfil</h3>
            <div class="form-group">
                <label>Nombre completo:</label>
                <input type="text" id="profileFullName" class="form-control" required>
            </div>
            <div class="form-group">
                <label>Contrase√±a actual:</label>
                <input type="password" id="currentPassword" class="form-control">
            </div>
            <div class="form-group">
                <label>Nueva contrase√±a (opcional):</label>
                <input type="password" id="newPassword" class="form-control">
            </div>
            <div class="user-level" id="userLevelInfo"></div>
            <button onclick="updateProfile()" class="btn btn-primary">Guardar</button>
            <button onclick="closeModal()" class="btn">Cancelar</button>
        </div>
    </div>

    <!-- Modal de administraci√≥n -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <h3>Administrar Usuarios</h3>
            <div id="usersList" class="form-group"></div>
            <h4>Crear Nuevo Usuario</h4>
            <div class="form-group">
                <label>Nombre de Usuario:</label>
                <input type="text" id="newUsername" class="form-control">
            </div>
            <div class="form-group">
                <label>Contrase√±a:</label>
                <input type="password" id="newUserPassword" class="form-control">
            </div>
            <div class="form-group">
                <label>Nombre Completo:</label>
                <input type="text" id="newUserFullName" class="form-control">
            </div>
            <div class="form-group">
                <label>Nivel:</label>
                <input type="text" id="newUserLevel" class="form-control" placeholder="admin, advanced, basic, o personalizado">
            </div>
            <div class="form-group">
                <label>Permisos:</label><br>
                <input type="checkbox" id="permissionDelete" class="permission-checkbox"> Eliminar archivos
                <input type="checkbox" id="permissionEdit" class="permission-checkbox"> Editar archivos
                <input type="checkbox" id="permissionUpload" class="permission-checkbox"> Subir archivos
                <input type="checkbox" id="permissionCreateFolder" class="permission-checkbox"> Crear carpetas
            </div>
            <button onclick="createNewUser()" class="btn btn-primary">Crear Usuario</button>
            <button onclick="closeModal()" class="btn">Cerrar</button>
        </div>
    </div>



    
    

    <div class="modal fade" id="exampleModalToggle" aria-hidden="true" aria-labelledby="exampleModalToggleLabel" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="upload-section w-100">
                <h2>Subir Archivo</h2>
                <form id="uploadForm">
                    <div class="form-group">
                        <label>Seleccionar carpeta:</label>
                        <select id="folderSelect" class="form-control">
                            <option value="">Ra√≠z</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="archivo">Seleccionar archivo:</label>
                        <input type="file" id="fileInput" class="form-control" required>
                        <span id="nombre-archivo">Ning√∫n archivo seleccionado</span>
                    </div>
              
                    <div class="form-group">
                        <label for="descripcion">Descripci√≥n del archivo:</label>
                        <textarea id="fileDescription" name="descripcion" class="form-control" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-outline-info">Subir Archivo</button>
                </form>
            </div>
          </div>
        </div>
      </div>
      
      <button class="btn btn-primary" data-bs-target="#exampleModalToggle" data-bs-toggle="modal"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cloud-upload-fill" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M8 0a5.53 5.53 0 0 0-3.594 1.342c-.766.66-1.321 1.52-1.464 2.383C1.266 4.095 0 5.555 0 7.318 0 9.366 1.708 11 3.781 11H7.5V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707V11h4.188C14.502 11 16 9.57 16 7.773c0-1.636-1.242-2.969-2.834-3.194C12.923 1.999 10.69 0 8 0m-.5 14.5V11h1v3.5a.5.5 0 0 1-1 0"/>
    </svg>Subir archivo</button>



















    <div class="search-section">
        <h2>Buscar Archivos</h2>
        <div class="form-group">
            <input type="text" id="searchInput" class="form-control" placeholder="Buscar por nombre o descripci√≥n">
        </div>
        <div class="form-group">
            <label for="searchDate">Fecha de ingreso:</label>
            <input type="date" id="searchDate" class="form-control">
        </div>
        <button id="searchBtn" class="btn btn-search">Buscar</button>
    </div>

    

    <div class="files-section">
        <div class="files-header">
            <button id="backBtn" class="back-btn" style="display: none;" onclick="navigateBack()">‚Üê</button>
            <h2>Archivos y Carpetas</h2>
            <div class="files-actions">
                <div class="view-toggle">
                    <button id="listViewBtn" class="btn" title="Vista de lista">üìã</button>
                    <button id="gridViewBtn" class="btn" title="Vista de cuadr√≠cula">üì±</button>
                </div>
                <button id="newFolderBtn" class="btn btn-success" ><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-folder-plus" viewBox="0 0 16 16">
                    <path d="m.5 3 .04.87a2 2 0 0 0-.342 1.311l.637 7A2 2 0 0 0 2.826 14H9v-1H2.826a1 1 0 0 1-.995-.91l-.637-7A1 1 0 0 1 2.19 4h11.62a1 1 0 0 1 .996 1.09L14.54 8h1.005l.256-2.819A2 2 0 0 0 13.81 3H9.828a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 6.172 1H2.5a2 2 0 0 0-2 2m5.672-1a1 1 0 0 1 .707.293L7.586 3H2.19q-.362.002-.683.12L1.5 2.98a1 1 0 0 1 1-.98z"/>
                    <path d="M13.5 9a.5.5 0 0 1 .5.5V11h1.5a.5.5 0 1 1 0 1H14v1.5a.5.5 0 1 1-1 0V12h-1.5a.5.5 0 0 1 0-1H13V9.5a.5.5 0 0 1 .5-.5"/>
                  </svg> Nueva Carpeta</button>
                <button id="refreshBtn" class="btn btn-warning"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-counterclockwise" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2z"/>
                    <path d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466"/>
                  </svg></button>
            </div>
        </div>
        
        <div id="breadcrumb" class="breadcrumb">
            <span class="breadcrumb-item" onclick="navigateToFolder('')">Inicio</span>
        </div>

        <table class="files-table">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Tipo</th>
                    <th>Fecha de ingreso</th>
                    <th>Descripci√≥n</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="filesTableBody"></tbody>
        </table>
    </div>

    <!-- Modal para crear/editar carpeta -->
    <div id="folderModal" class="modal">
        <div class="modal-content">
            <h3>Nueva Carpeta</h3>
            <div class="form-group">
                <label>Nombre de la carpeta:</label>
                <input type="text" id="folderName" class="form-control" required>
            </div>
            <button id="saveFolderBtn" class="btn btn-primary">Guardar</button>
            <button onclick="closeModal()" class="btn">Cancelar</button>
        </div>
    </div>

    <!-- Modal para editar archivo -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <h3>Editar Archivo</h3>
            <div class="form-group">
                <label>Descripci√≥n:</label>
                <textarea id="editDescription" class="form-control" required></textarea>
            </div>
            <div class="form-group">
                <label>Carpeta:</label>
                <select id="editFolderSelect" class="form-control"></select>
            </div>
            <button id="saveEditBtn" class="btn btn-primary">Guardar</button>
            <button onclick="closeModal()" class="btn">Cancelar</button>
        </div>
    </div>

    <script>
        // Variables globales
        let files = JSON.parse(localStorage.getItem('files')) || [];
        let folders = JSON.parse(localStorage.getItem('folders')) || [];
        let currentFolder = ''; // ID de la carpeta actual, vac√≠o para la ra√≠z
        let currentEditId = null;
        let currentUser = null;
        let users = JSON.parse(localStorage.getItem('users')) || [
            {
                username: 'admin',
                password: 'admin123',
                fullName: 'Administrador',
                level: 'admin'
            }
        ];

        let isGridView = localStorage.getItem('isGridView') === 'true';

        function toggleView(gridView) {
            isGridView = gridView;
            localStorage.setItem('isGridView', gridView);
            updateFilesTable();
        }

        function downloadFile(id) {
            const file = files.find(f => f.id === id);
            if (file) {
                const link = document.createElement('a');
                link.href = file.content;
                link.download = file.name;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        // Funciones de modal
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
        }

        // Actualizar select de carpetas
        function updateFolderSelects() {
            const selects = ['folderSelect', 'editFolderSelect'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                select.innerHTML = '<option value="">Ra√≠z</option>';
                
                function addFolderOption(folder, depth = 0) {
                    const indent = '- '.repeat(depth);
                    select.innerHTML += `<option value="${folder.id}">${indent}${folder.name}</option>`;
                    
                    const subfolders = folders.filter(f => f.parentId === folder.id);
                    subfolders.forEach(subfolder => addFolderOption(subfolder, depth + 1));
                }
                
                folders.filter(folder => !folder.parentId).forEach(folder => addFolderOption(folder));
            });
        }

        // Manejador de nueva carpeta
        document.getElementById('newFolderBtn').addEventListener('click', () => {
            if (currentUser.permissions?.createFolder || currentUser.level === 'admin') {
                showModal('folderModal');
            } else {
                alert('No tienes permiso para crear carpetas.');
            }
        });

        document.getElementById('saveFolderBtn').addEventListener('click', () => {
            const name = document.getElementById('folderName').value;
            if (name) {
                const newFolder = {
                    id: Date.now(),
                    name: name,
                    parentId: currentFolder || null,
                    createdBy: currentUser.username,
                    level: currentUser.level,
                    createdAt: new Date().toISOString().split('T')[0]
                };
                folders.push(newFolder);
                localStorage.setItem('folders', JSON.stringify(folders));
                updateFolderSelects();
                closeModal();
                document.getElementById('folderName').value = '';
                updateFilesTable();
            }
        });

        // Manejador de subida de archivos
        document.getElementById('uploadForm').addEventListener('submit', function(e) {
            e.preventDefault();
            if (currentUser.permissions?.upload || currentUser.level === 'admin') {
                const fileInput = document.getElementById('fileInput');
                const description = document.getElementById('fileDescription').value;
                const folderId = currentFolder || document.getElementById('folderSelect').value;
                
                if (fileInput.files.length > 0) {
                    const file = fileInput.files[0];
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const newFile = {
                            id: Date.now(),
                            name: file.name,
                            type: file.type || 'Archivo',
                            date: new Date().toISOString().split('T')[0],
                            description: description,
                            content: e.target.result,
                            folderId: folderId
                        };
                        
                        console.log('New file:', newFile);
                        files.push(newFile);
                        localStorage.setItem('files', JSON.stringify(files));
                        if (folderId) {
                            navigateToFolder(folderId);
                        } else {
                            updateFilesTable();
                        }
                        document.getElementById('uploadForm').reset();
                    };
                    
                    reader.readAsDataURL(file);
                }
            } else {
                alert('No tienes permiso para subir archivos.');
            }
        });

        // Funci√≥n para navegar entre carpetas
        function navigateToFolder(folderId) {
            console.log('Navigating to folder:', folderId);
            if (folderId) {
                const folder = folders.find(f => f.id === parseInt(folderId));
                if (folder) {
                    // Verificar permisos
                    if (currentUser.level === 'admin' || 
                        currentUser.level === folder.level || 
                        (currentUser.level === 'advanced' && folder.level === 'basic')) {
                        currentFolder = folderId;
                        document.getElementById('folderSelect').value = currentFolder;
                        updateBreadcrumb();
                        updateFilesTable();
                    } else {
                        alert('No tienes permisos para acceder a esta carpeta');
                    }
                    return;
                }
            }
            currentFolder = '';
            document.getElementById('folderSelect').value = '';
            updateBreadcrumb();
            updateFilesTable();
        }

        // Actualizar la ruta de navegaci√≥n
        function updateBreadcrumb() {
            const breadcrumb = document.getElementById('breadcrumb');
            breadcrumb.innerHTML = '<span class="breadcrumb-item" onclick="navigateToFolder(\'\')">Inicio</span>';
            
            if (currentFolder) {
                const folder = folders.find(f => f.id === parseInt(currentFolder));
                if (folder) {
                    breadcrumb.innerHTML += `
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item current-folder">${folder.name}</span>
                    `;
                }
            }
        }

        // Funci√≥n actualizada para mostrar archivos y carpetas
        function updateFilesTable() {
            document.getElementById('backBtn').style.display = currentFolder ? 'flex' : 'none';
            console.log('Current folder:', currentFolder);
            console.log('All files:', files);
            const tbody = document.getElementById('filesTableBody');
            const table = document.querySelector('.files-table');
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            const searchDate = document.getElementById('searchDate').value;
            
            if (isGridView) {
                // Create grid container if it doesn't exist
                let gridContainer = document.querySelector('.grid-view');
                if (!gridContainer) {
                    gridContainer = document.createElement('div');
                    gridContainer.className = 'grid-view';
                    table.parentNode.insertBefore(gridContainer, table);
                }
                gridContainer.innerHTML = '';
                table.style.display = 'none';
                
                // Show folders in grid view
                if (!currentFolder) {
                    folders.filter(folder => 
                        folder.name.toLowerCase().includes(searchInput) ||
                        (folder.description && folder.description.toLowerCase().includes(searchInput)) ||
                        (folder.createdAt && folder.createdAt.includes(searchDate))
                    ).forEach(folder => {
                        const div = document.createElement('div');
                        div.className = 'grid-view-item';
                        div.onclick = () => navigateToFolder(folder.id);
                        div.innerHTML = `
                            <div class="grid-view-icon">üìÅ</div>
                            <div class="grid-view-name">${folder.name}</div>
                        `;
                        gridContainer.appendChild(div);
                    });
                }
                
                // Show files in grid view
                const filteredFiles = files.filter(file => 
                    (currentFolder ? file.folderId === currentFolder : !file.folderId) &&
                    (file.name.toLowerCase().includes(searchInput) || 
                     file.description.toLowerCase().includes(searchInput)) &&
                    (!searchDate || file.date === searchDate)
                );
                
                filteredFiles.forEach(file => {
                    const div = document.createElement('div');
                    div.className = 'grid-view-item';
                    div.innerHTML = `
                        <div class="grid-view-icon">üìÑ</div>
                        <div class="grid-view-name">${file.name}</div>
                        <div class="grid-view-actions">
                            <button onclick="viewFile(${file.id}); event.stopPropagation();" class="action-btn view-btn"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye-fill" viewBox="0 0 16 16">
  <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0"/>
  <path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8m8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7"/>
</svg></button>
                            <button onclick="downloadFile(${file.id}); event.stopPropagation();" class="action-btn"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-download" viewBox="0 0 16 16">
  <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
  <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z"/>
</svg></button>
                            <button onclick="editFile(${file.id}); event.stopPropagation();" class="action-btn edit-btn"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-fill" viewBox="0 0 16 16">
  <path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.5.5 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11z"/>
</svg></button>
                            <button onclick="deleteFile(${file.id}); event.stopPropagation();" class="action-btn delete-btn"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3-fill" viewBox="0 0 16 16">
  <path d="M11 1.5v1h3.5a.5.5 0 0 1 0 1h-.538l-.853 10.66A2 2 0 0 1 11.115 16h-6.23a2 2 0 0 1-1.994-1.84L2.038 3.5H1.5a.5.5 0 0 1 0-1H5v-1A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5m-5 0v1h4v-1a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5M4.5 5.029l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06m6.53-.528a.5.5 0 0 0-.528.47l-.5 8.5a.5.5 0 0 0 .998.058l.5-8.5a.5.5 0 0 0-.47-.528M8 4.5a.5.5 0 0 0-.5.5v8.5a.5.5 0 0 0 1 0V5a.5.5 0 0 0-.5-.5"/>
</svg></button>
                        </div>
                    `;
                    gridContainer.appendChild(div);
                });
            } else {
                // List view (original table view)
                const gridContainer = document.querySelector('.grid-view');
                if (gridContainer) {
                    gridContainer.remove();
                }
                table.style.display = 'table';
                tbody.innerHTML = '';
                
                if (!currentFolder) {
                    folders.filter(folder => 
                        folder.name.toLowerCase().includes(searchInput) ||
                        (folder.description && folder.description.toLowerCase().includes(searchInput)) ||
                        (folder.createdAt && folder.createdAt.includes(searchDate))
                    ).forEach(folder => {
                        const tr = document.createElement('tr');
                        tr.className = 'folder-row';
                        tr.onclick = () => navigateToFolder(folder.id);
                        tr.innerHTML = `
                            <td>
                                <span class="folder-icon">üìÅ</span>
                                ${folder.name}
                            </td>
                            <td>Carpeta</td>
                            <td>${folder.createdAt || new Date(folder.id).toLocaleDateString()}</td>
                            <td>${folder.description || 'Carpeta de archivos'}</td>
                            <td>
                                <button onclick="deleteFolder(${folder.id}); event.stopPropagation();" 
                                        class="action-btn delete-btn"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3-fill fs-5" viewBox="0 0 16 16">
  <path d="M11 1.5v1h3.5a.5.5 0 0 1 0 1h-.538l-.853 10.66A2 2 0 0 1 11.115 16h-6.23a2 2 0 0 1-1.994-1.84L2.038 3.5H1.5a.5.5 0 0 1 0-1H5v-1A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5m-5 0v1h4v-1a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5M4.5 5.029l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06m6.53-.528a.5.5 0 0 0-.528.47l-.5 8.5a.5.5 0 0 0 .998.058l.5-8.5a.5.5 0 0 0-.47-.528M8 4.5a.5.5 0 0 0-.5.5v8.5a.5.5 0 0 0 1 0V5a.5.5 0 0 0-.5-.5"/>
</svg></button>
                            </td>
                        `;
                        tbody.appendChild(tr);
                    });
                }
                
                const filteredFiles = files.filter(file => 
                    (currentFolder ? file.folderId === currentFolder : !file.folderId) &&
                    (file.name.toLowerCase().includes(searchInput) || 
                     file.description.toLowerCase().includes(searchInput)) &&
                    (!searchDate || file.date === searchDate)
                );
                
                filteredFiles.forEach(file => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>
                            <span class="folder-icon">üìÑ</span>
                            ${file.name}
                        </td>
                        <td>${file.type}</td>
                        <td>${file.date}</td>
                        <td>${file.description}</td>
                        <td>
                            <button onclick="viewFile(${file.id})" class="action-btn view-btn"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye-fill" viewBox="0 0 16 16">
  <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0"/>
  <path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8m8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7"/>
</svg></button>
                            <button onclick="printFile(${file.id})" class="action-btn print-btn"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-printer-fill fs-5" viewBox="0 0 16 16">
  <path d="M5 1a2 2 0 0 0-2 2v1h10V3a2 2 0 0 0-2-2zm6 8H5a1 1 0 0 0-1 1v3a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1"/>
  <path d="M0 7a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2h-1v-2a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v2H2a2 2 0 0 1-2-2zm2.5 1a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1"/>
</svg></button>
                            <button onclick="editFile(${file.id})" class="action-btn edit-btn"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-fill" viewBox="0 0 16 16">
  <path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.5.5 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11z"/>
</svg></button>
                            <button onclick="deleteFile(${file.id})" class="action-btn delete-btn"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3-fill fs-5" viewBox="0 0 16 16">
  <path d="M11 1.5v1h3.5a.5.5 0 0 1 0 1h-.538l-.853 10.66A2 2 0 0 1 11.115 16h-6.23a2 2 0 0 1-1.994-1.84L2.038 3.5H1.5a.5.5 0 0 1 0-1H5v-1A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5m-5 0v1h4v-1a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5M4.5 5.029l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06m6.53-.528a.5.5 0 0 0-.528.47l-.5 8.5a.5.5 0 0 0 .998.058l.5-8.5a.5.5 0 0 0-.47-.528M8 4.5a.5.5 0 0 0-.5.5v8.5a.5.5 0 0 0 1 0V5a.5.5 0 0 0-.5-.5"/>
</svg></button>
                            <button onclick="downloadFile(${file.id})" class="action-btn"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-download" viewBox="0 0 16 16">
  <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
  <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z"/>
</svg></button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            }
        }

        // Funci√≥n para visualizar archivo
        function viewFile(id) {
            const file = files.find(f => f.id === id);
            if (file) {
                const viewWindow = window.open('', '_blank');
                viewWindow.document.write(`
                    <html>
                        <head>
                            <title>${file.name}</title>
                            <style>
                                body { font-family: system-ui; padding: 20px; }
                                img { max-width: 100%; }
                            </style>
                        </head>
                        <body>
                            <h1>${file.name}</h1>
                            <p><strong>Fecha:</strong> ${file.date}</p>
                            <p><strong>Descripci√≥n:</strong> ${file.description}</p>
                            ${file.type.includes('image') ? 
                                `<img src="${file.content}">` : 
                                `<pre>${file.content}</pre>`}
                        </body>
                    </html>
                `);
            }
        }

        // Funci√≥n para eliminar archivo
        function deleteFile(id) {
            if (currentUser.permissions?.delete || currentUser.level === 'admin') {
                if (confirm('¬øEst√° seguro de que desea eliminar este archivo?')) {
                    files = files.filter(file => file.id !== id);
                    localStorage.setItem('files', JSON.stringify(files));
                    updateFilesTable();
                }
            } else {
                alert('No tienes permiso para eliminar archivos.');
            }
        }

        // Funci√≥n para imprimir archivo
        function printFile(id) {
            const file = files.find(f => f.id === id);
            if (file) {
                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <html>
                        <head>
                            <title>${file.name}</title>
                        </head>
                        <body>
                            <h1>${file.name}</h1>
                            <p><strong>Fecha:</strong> ${file.date}</p>
                            <p><strong>Descripci√≥n:</strong> ${file.description}</p>
                            ${file.type.includes('image') ? 
                                `<img src="${file.content}" style="max-width: 100%;">` : 
                                `<pre>${file.content}</pre>`}
                        </body>
                    </html>
                `);
                printWindow.document.close();
                printWindow.print();
            }
        }

        // Funci√≥n para editar archivo
        function editFile(id) {
            if (currentUser.permissions?.edit || currentUser.level === 'admin') {
                const file = files.find(f => f.id === id);
                if (file) {
                    currentEditId = id;
                    document.getElementById('editDescription').value = file.description;
                    document.getElementById('editFolderSelect').value = file.folderId || '';
                    showModal('editModal');
                }
            } else {
                alert('No tienes permiso para editar archivos.');
            }
        }

        // Guardar edici√≥n de archivo
        document.getElementById('saveEditBtn').addEventListener('click', () => {
            if (currentEditId) {
                const file = files.find(f => f.id === currentEditId);
                if (file) {
                    file.description = document.getElementById('editDescription').value;
                    file.folderId = document.getElementById('editFolderSelect').value;
                    localStorage.setItem('files', JSON.stringify(files));
                    updateFilesTable();
                    closeModal();
                }
            }
        });

        // Funci√≥n para eliminar carpeta
        function deleteFolder(id) {
            if (confirm('¬øEst√° seguro de que desea eliminaresta carpeta y todos sus archivos?')) {
                // Eliminar todos los archivos de la carpeta
                files = files.filter(file => file.folderId !== id.toString());
                // Eliminar la carpeta
                folders = folders.filter(folder => folder.id !== id);
                
                localStorage.setItem('files', JSON.stringify(files));
                localStorage.setItem('folders', JSON.stringify(folders));
                updateFilesTable();
            }
        }

        // Bot√≥n de actualizar
        document.getElementById('refreshBtn').addEventListener('click', () => {
            updateFilesTable();
        });

        // Funciones de usuario
        function initializeUser() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                updateUserDisplay();
            } else {
                showLoginModal();
            }
        }

        function updateUserDisplay() {
            const avatar = document.getElementById('userAvatar');
            const nameDisplay = document.getElementById('userName');
            const adminMenuItem = document.getElementById('adminMenuItem');

            if (currentUser) {
                avatar.textContent = currentUser.fullName.charAt(0);
                nameDisplay.textContent = currentUser.fullName;
                adminMenuItem.style.display = currentUser.level === 'admin' ? 'block' : 'none';
                document.querySelector('.files-section').style.display = 'block';
            } else {
                avatar.textContent = 'U';
                nameDisplay.textContent = 'Usuario';
                adminMenuItem.style.display = 'none';
                document.querySelector('.files-section').style.display = 'none';
            }
        }

        function toggleUserMenu() {
            const dropdown = document.getElementById('userDropdown');
                        dropdown.classList.toggle('active');
        }

        function showLoginModal() {
            showModal('loginModal');
        }

        function showRegisterModal() {
            closeModal();
            showModal('registerModal');
        }

        function showProfileModal() {
            if (currentUser) {
                document.getElementById('profileFullName').value = currentUser.fullName;
                document.getElementById('userLevelInfo').textContent = `Nivel: ${currentUser.level}`;
                showModal('profileModal');
            }
        }

        function showAdminModal() {
            if (currentUser?.level === 'admin') {
                const usersList = document.getElementById('usersList');
                usersList.innerHTML = '';
                
                users.forEach(user => {
                    if (user.username !== 'admin') {
                        const userDiv = document.createElement('div');
                        userDiv.className = 'user-dropdown-item';
                        userDiv.innerHTML = `
                            ${user.fullName} (${user.username}) - ${user.level}
                            <input type="text" value="${user.level}" onchange="changeUserLevel('${user.username}', this.value)" class="user-level-select">
                            <div>
                                <input type="checkbox" ${user.permissions?.delete ? 'checked' : ''} onchange="updateUserPermission('${user.username}', 'delete', this.checked)"> Eliminar
                                <input type="checkbox" ${user.permissions?.edit ? 'checked' : ''} onchange="updateUserPermission('${user.username}', 'edit', this.checked)"> Editar
                                <input type="checkbox" ${user.permissions?.upload ? 'checked' : ''} onchange="updateUserPermission('${user.username}', 'upload', this.checked)"> Subir
                                <input type="checkbox" ${user.permissions?.createFolder ? 'checked' : ''} onchange="updateUserPermission('${user.username}', 'createFolder', this.checked)"> Crear Carpetas
                            </div>
                            <button onclick="deleteUser('${user.username}')" class="btn delete-btn"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3-fill fs-5" viewBox="0 0 16 16">
  <path d="M11 1.5v1h3.5a.5.5 0 0 1 0 1h-.538l-.853 10.66A2 2 0 0 1 11.115 16h-6.23a2 2 0 0 1-1.994-1.84L2.038 3.5H1.5a.5.5 0 0 1 0-1H5v-1A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5m-5 0v1h4v-1a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5M4.5 5.029l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06m6.53-.528a.5.5 0 0 0-.528.47l-.5 8.5a.5.5 0 0 0 .998.058l.5-8.5a.5.5 0 0 0-.47-.528M8 4.5a.5.5 0 0 0-.5.5v8.5a.5.5 0 0 0 1 0V5a.5.5 0 0 0-.5-.5"/>
</svg></button>
                        `;
                        usersList.appendChild(userDiv);
                    }
                });
                
                showModal('adminModal');
            }
        }

        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                updateUserDisplay();
                closeModal();
            } else {
                alert('Usuario o contrase√±a incorrectos');
            }
        }

        function register() {
            const username = document.getElementById('registerUsername').value;
            const password = document.getElementById('registerPassword').value;
            const fullName = document.getElementById('registerFullName').value;
            
            if (users.some(u => u.username === username)) {
                alert('El usuario ya existe');
                return;
            }
            
            const newUser = {
                username,
                password,
                fullName,
                level: 'basic'
            };
            
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            currentUser = newUser;
            localStorage.setItem('currentUser', JSON.stringify(newUser));
            
            updateUserDisplay();
            closeModal();
        }

        function updateProfile() {
            const fullName = document.getElementById('profileFullName').value;
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            
            if (currentPassword && currentPassword !== currentUser.password) {
                alert('Contrase√±a actual incorrecta');
                return;
            }
            
            const userIndex = users.findIndex(u => u.username === currentUser.username);
            if (userIndex !== -1) {
                users[userIndex].fullName = fullName;
                if (newPassword) {
                    users[userIndex].password = newPassword;
                }
                
                localStorage.setItem('users', JSON.stringify(users));
                currentUser = users[userIndex];
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                updateUserDisplay();
                closeModal();
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            updateUserDisplay();
            showLoginModal();
        }

        function changeUserLevel(username, newLevel) {
            const userIndex = users.findIndex(u => u.username === username);
            if (userIndex !== -1) {
                users[userIndex].level = newLevel;
                localStorage.setItem('users', JSON.stringify(users));
            }
        }

        function deleteUser(username) {
            if (confirm('¬øEst√° seguro de que desea eliminar este usuario?')) {
                users = users.filter(u => u.username !== username);
                localStorage.setItem('users', JSON.stringify(users));
                showAdminModal();
            }
        }

        function createNewUser() {
            const username = document.getElementById('newUsername').value;
            const password = document.getElementById('newUserPassword').value;
            const fullName = document.getElementById('newUserFullName').value;
            const level = document.getElementById('newUserLevel').value;
            
            if (users.some(u => u.username === username)) {
                alert('El usuario ya existe');
                return;
            }
            
            const newUser = {
                username,
                password,
                fullName,
                level,
                permissions: {
                    delete: document.getElementById('permissionDelete').checked,
                    edit: document.getElementById('permissionEdit').checked,
                    upload: document.getElementById('permissionUpload').checked,
                    createFolder: document.getElementById('permissionCreateFolder').checked
                }
            };
            
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            showAdminModal(); // Refresh the admin modal
        }

        function updateUserPermission(username, permission, value) {
            const userIndex =users.findIndex(u => u.username === username);
            if (userIndex !== -1) {
                users[userIndex].permissions = users[userIndex].permissions || {};
                users[userIndex].permissions[permission] = value;
                localStorage.setItem('users', JSON.stringify(users));
            }
        }


        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', () => {
            files = JSON.parse(localStorage.getItem('files')) || [];
            folders = JSON.parse(localStorage.getItem('folders')) || [];
            console.log('Loaded files:', files);
            console.log('Loaded folders:', folders);
            
            initializeUser();
            updateFolderSelects();
            updateFilesTable();
            updateBreadcrumb();
            
            // Add this new event listener
            document.getElementById('searchBtn').addEventListener('click', updateFilesTable);
            
            // Add these new event listeners
            document.getElementById('searchInput').addEventListener('input', updateFilesTable);
            document.getElementById('searchDate').addEventListener('change', updateFilesTable);
        });

        // Cerrar men√∫ de usuario al hacer clic fuera
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.user-menu')) {
                document.getElementById('userDropdown').classList.remove('active');
            }
        });

        // Add event listeners for view toggle buttons
        document.addEventListener('DOMContentLoaded', () => {
            const listViewBtn = document.getElementById('listViewBtn');
            const gridViewBtn = document.getElementById('gridViewBtn');
            
            listViewBtn.addEventListener('click', () => toggleView(false));
            gridViewBtn.addEventListener('click', () => toggleView(true));
            
            // Update initial view
            toggleView(isGridView);
        });

        function navigateBack() {
            if (currentFolder) {
                const currentFolderObj = folders.find(f => f.id === parseInt(currentFolder));
                if (currentFolderObj) {
                    navigateToFolder(currentFolderObj.parentId || '');
                }
            }
        }
    </script>
</body>


</html>
